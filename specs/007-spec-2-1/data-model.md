# Data Model: Complete API Operation Implementation

This document outlines the key data entities for the feature, as derived from the `spec.md` and `research.md`.

## 1. API Operation

- **Description**: Represents a single, executable Bitbucket API endpoint. It is the core entity that the `call-id` tool acts upon. These are internal representations, not public MCP tools.
- **Attributes**:
  - `id` (string, required): The unique identifier for the operation (e.g., `bitbucket.repos.list`).
  - `summary` (string, required): A short, human-readable description of what the operation does.
  - `description` (string, optional): A more detailed explanation of the operation's purpose and behavior.
  - `httpMethod` (string, required): The HTTP method used for the API call (e.g., `GET`, `POST`, `PUT`, `DELETE`).
  - `path` (string, required): The API endpoint path, with placeholders for parameters (e.g., `/2.0/repositories/{workspace}/{repo_slug}`).
  - `parameters` (ZodSchema, required): A Zod schema defining the expected input parameters, including path, query, and body parameters. This is used by `call-id` for runtime validation.
  - `response` (ZodSchema, required): A Zod schema defining the expected shape of a successful API response.
  - `errorResponses` (ZodSchema, optional): A Zod schema defining the shape of possible error responses.
  - `tags` (string[], optional): Keywords or categories for discoverability (e.g., `["repository", "pull-request"]`).
  - `compatibility` (object, required): Specifies which Bitbucket versions this operation is compatible with.
    - `cloud` (boolean): `true` if compatible with Bitbucket Cloud.
    - `dataCenter` (string | boolean): A semver range (e.g., `>=8.0.0`) or `true` if compatible with Bitbucket Data Center.

## 2. Contract Test

- **Description**: An automated test (`jest`) that validates a single `API Operation`. It is a development artifact, not a runtime entity.
- **Attributes**:
  - `testName` (string, required): Describes the test case (e.g., `should create a pull request with valid parameters`).
  - `operationId` (string, required): The ID of the `API Operation` being tested.
  - `inputParameters` (object, required): A valid set of parameters to be passed to the `call-id` tool for the test.
  - `expectedOutcome` (object, required): The expected result, which could be a successful response matching the `response` schema or a specific error.
  - `mockData` (object, optional): Data used to set up the test environment in Bitbucket before the test runs (e.g., creating a temporary repository).

## 3. Embedding

- **Description**: A numerical vector representation of an `API Operation`'s text-based metadata. This entity is stored in the `sqlite-vec` database and is used exclusively by the `search-ids` tool.
- **Attributes**:
  - `vector` (number[], required): The high-dimensional floating-point array generated by the sentence-transformer model.
  - `metadata` (object, required): The associated data stored alongside the vector.
    - `operationId` (string, required): The ID of the `API Operation` this embedding represents.
    - `text` (string, required): The source text that was embedded (concatenation of `id`, `summary`, `description`, and `tags`).
    - `compatibility` (object, required): A copy of the `API Operation`'s compatibility information, used for filtering search results.
